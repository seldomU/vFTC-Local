<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
  <!-- https://www.youtube.com/watch?v=r9ZTWQtzk2Y -->
  <!-- <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline'; script-src-elem 'self' 'unsafe-inline' https://developers.google.com/blockly/xml">
  <meta http-equiv="X-Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline'; script-src-elem 'self' 'unsafe-inline' https://developers.google.com/blockly/xml"> -->
  <title>Virtual Robot Simulator Controller</title>
  <style>
    body {
      background-color: #242424;
    }

    h1 {
      margin-top: 0%;
      font-weight: normal;
      font-size: 35px;
      font-family: Jura;
      font-weight: bolder;
      color: white;
    }

    h2 {
      margin-top: 10px;
      margin-bottom: 10px;
      font-size: 17.5px;
      padding-left: 35px;
      padding-right: 35px;
      font-family: Jura;
      color: white;
    }

    .buttonText {
      top: 7.5px;
      position: relative;
      font-size: 30px;
      font-weight: bolder;
      font-family: Jura;
      color: white;
      cursor: default;
    }

    .textNormal {
      color: grey;
      cursor: pointer;
      transition-duration: 0.4s;
    }

    .textNormal:hover {
      color: white;
    }

    .textDisabled {
      color: darkslategrey;
    }

    .center {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    }

    .center-horizontal {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    @font-face {
      font-family: 'Jura';
      src: url('./blocks/fonts/Jura-Light.ttf');
    }

    .blocklyText,
    .blocklyHtmlInput,
    .blocklyTreeLabel {
      font-family: 'Jura', sans-serif !important;
    }

    .blocklyTreeLabel {
      font-size: 20px !important;
    }

    .blocklyTreeRow {
      height: 28px !important;
      margin-top: 5px !important;
    }

    input:focus,
    textarea:focus,
    div:focus,
    select:focus {
      outline: none;
    }


    .button1 {
      background-color: white;
      border-radius: 6px;
      color: #242424;
      text-align: center;
      font-family: Jura;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      font-size: 15px;
      transition-duration: 0.4s;
      cursor: pointer;
    }

    .button1 {
      background-color: #242424;
      color: white;
      border: 2px solid white;
    }

    .button1:hover {
      background-color: white;
      color: #242424;
    }

    .button1:focus {
      outline: none;
      box-shadow: none;
    }

    .button1:disabled {
      border: 2px solid grey;
      background-color: transparent;
      color: grey;
      cursor: inherit;
    }

    .chevron::before {
      border-style: solid;
      border-width: 0.25em 0.25em 0 0;
      content: '';
      display: inline-block;
      height: 0.45em;
      left: 0.15em;
      position: relative;
      top: 0.15em;
      transform: rotate(-45deg);
      vertical-align: top;
      width: 0.45em;
      color: white;
      cursor: pointer;
    }

    .chevron.left:before {
      left: 0.25em;
      transform: rotate(-135deg);
    }

    input[type=text] {
      width: 225px;
      box-sizing: border-box;
      border: 2px solid white;
      border-radius: 6px;
      font-family: Jura;
      text-align: center;
      font-size: 15px;
      background-color: #242424;
      color: white;
    }

    .dropdown-select {
      font-family: Jura;
      font-size: 15px;
      position: relative;
      font-weight: bold;
      border: 0;
      cursor: pointer;
    }

    .dropdown-select>option {
      margin: 3px;
      padding: 6px 8px;
      cursor: pointer;
    }

    .dropdown-dark {
      border-radius: 12px;
      background-color: #242424;
    }

    .dropdown-dark:before {
      border-bottom-color: white;
    }

    .dropdown-dark:after {
      border-top-color: white;
    }

    .dropdown-dark .dropdown-select {
      color: white;
      text-shadow: 0 1px black;
      background: #242424;
    }

    .dropdown-dark .dropdown-select:focus {
      color: white;
    }

    .dropdown-dark .dropdown-select>option {
      background: #242424;
    }

    ::-webkit-scrollbar {
      width: 0px;
      background: transparent;
      /* make scrollbar transparent */
    }

    .divider {
      width: 7.5px;
      height: 7.5px;
      display: inline-block;
      background-color: white;
      margin-left: 13.75px;
      margin-right: 13.75px;
      transform: rotate(90deg);
      top: -3.5px;
      position: relative;
    }

    #videoTab {
      display: none;
      position: absolute;
      top: 36.5px;
      left: 50%;
      margin-left: 6px;
      padding: 8px;
      padding-bottom: 10px;
      background-color: #242424;
      z-index: 100;
      border: 1px solid white;
    }

    #overlay {
      visibility: hidden;
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      z-index: 100;
      background-color: #00000044;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #overlayInfo {
      height: 50%;
      background-color: #242424;
      border: 1px solid white;
      height: 200px;
      width: 400px;
      margin-bottom: 150px;
    }

    @keyframes showOverlay {
      from {
        visibility: hidden;
        opacity: 0;
      }

      to {
        visibility: visible;
        opacity: 1;
      }
    }

    @keyframes hideOverlay {
      from {
        visibility: visible;
        opacity: 1;
      }

      to {
        visibility: hidden;
        opacity: 0;
      }
    }

    @keyframes showOverlayInfo {
      from {
        margin-bottom: 250px;
      }

      to {
        margin-bottom: 150px;
      }
    }

    @keyframes hideOverlayInfo {
      from {
        margin-bottom: 150px;
      }

      to {
        margin-bottom: 250px;
      }
    }
  </style>
</head>

<body>
  <script src="./blocks/blockly/blockly_compressed.js"></script>
  <script src="./blocks/blockly/blocks_compressed.js"></script>
  <script src="./blocks/blockly/msg/js/en.js"></script>
  <script src="./blocks/interpreter/acorn_interpreter.js"></script>
  <script src="./blocks/blockly/javascript_compressed.js"></script>

  <script src="./codemirror/lib/codemirror.js"></script>
  <link rel="stylesheet" href="./codemirror/lib/codemirror.css">
  <link rel="stylesheet" href="./codemirror/theme/darcula.css">

  <script src="./codemirror/addon/edit/closebrackets.js"></script>
  <script src="./codemirror/addon/comment/comment.js"></script>
  <script src="./codemirror/addon/fold/foldcode.js"></script>
  <script src="./codemirror/addon/fold/foldgutter.js"></script>
  <script src="./codemirror/addon/fold/brace-fold.js"></script>
  <script src="./codemirror/addon/fold/comment-fold.js"></script>
  <script src="./codemirror/addon/fold/indent-fold.js"></script>

  <link rel="stylesheet" href="./codemirror/addon/hint/show-hint.css">
  <script src="./codemirror/addon/hint/show-hint.js"></script>
  <script src="./codemirror/mode/clike/clike.js"></script>
  <script src="./codemirror/lib/util/formatting.js"></script>

  <link rel="stylesheet" href="toolbox_style.css">

  <link rel="stylesheet" href="./font-awesome/css/font-awesome.min.css">

  <div style="display: flex; display: inline;">
    <a href="homepage.html" id="backButton"><span class="chevron left"></span></a>
    <div style="width: 25px; display: inline-block;"></div>
    <button class="button1" onclick="switchToBlocks()">Blocks</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="switchToOnBotJava()">OnBotJava</button>

    <div class="divider"></div>

    <button class="button1" onclick="newProgram()">New Program</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="overlay(true, 0)">Save as...</button>
    <div style="width: 10px; display: inline-block;"></div>
    <div class="dropdown dropdown-dark" style="display: inline-block; background-color: #FFFFFF;">
      <select id="programSelect" class="dropdown-select" onchange="loadProgram()">
        <option value="Load Program">Load Program</option>
      </select>
    </div>
    <div style="width: 10px; display: inline-block;"></div>
    <button id="save" class="button1" onclick="autoSave()" disabled>Save</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button id="delete" class="button1" onclick="overlay(true, 1)" disabled>Delete</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button id="download" class="button1" disabled><i style="color: grey;">Download</i></button>

    <div class="divider"></div>

    <button class="button1" onclick="startProgram()">Start Program</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="stopProgram()">Stop Program</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="resetField()">Reset Field</button>


    <button class="button1" onClick="playVideo(false)" style="position: absolute; right: 25px;">Program Stuck?</button>
  </div>


  <div class="container" style="display: flex; height: 100%; padding-top: 5px;">
    <div id="blocklyDiv" style="width: 50%; border:1px solid white;"></div>
    <div id="onBotJavaDiv" style="width: 50%;border:1px solid white;" hidden>
      <h1 id="loadingOBJText">HI</h1>
    </div>

    <div style="width: 50%; background-color: #242424; padding-left: 10px;">
      <div id="controlPanel" style="height: 50%; background-color: #242424; border:1px solid white;">
        <div style="display: flex; display: inline;" class="buttonText">
          <div style="width: 20px; display: inline-block;"></div>
          <div id="firstTab" style="display: inline-block;" onclick="switchTab(this, 0)">Telemetry</div>
          <div class="divider"></div>
          <div style="display: inline-block;" onclick="switchTab(this, 1)" class="textNormal">Lessons</div>
          <div class="divider"></div>
          <div style="display: inline-block;" onclick="switchTab(this, 2)" class="textNormal">LMS</div>
          <div class="divider"></div>
          <div id="videoButton" style="display: inline-block;" onclick="switchTab(this, 3)" class="textDisabled">Video
          </div>
        </div>
        <div style="width:100%; height: 10px; background-color: #4B4B4B; margin-top: 15px; margin-bottom: 20px;"></div>
        <div id="tabOptions" style="height: 80%;">
          <div style="height: 100%; overflow: scroll;">
            <div style="width:100%; overflow:hidden; background-color: #323232;">
              <h2 id="telemetryText" style="font-size: 20px;">-Telemetry Output-</h2>
            </div>
          </div>
          <div style="display: none;">
            <div style="display: flex; justify-content: center;">
              <div class="dropdown dropdown-dark" style="display: inline-block; background-color: #FFFFFF;">
                <select id="lessonSelect" class="dropdown-select" onChange="loadLesson()" style="font-size:20px;">
                  <option value=-1>Coding Lessons</option>
                  <option value=0>Drive to White Line - 2 Motors</option> <!-- Timing			-->
                  <option value=1>Drive to White Line - 4 Motors</option> <!-- Timing x2		-->
                  <option value=2>Drive and Rotate 90 Degress</option> <!-- Precise Timing	-->
                  <option value=3>Drive and Rotate in a Square</option> <!-- Loops			-->
                  <option value=4>Drive and Strafe in a Square</option> <!-- Strafing		-->
                  <option value=5>Wobble Goal - 1st Position</option> <!-- First Task		-->
                  <option value=6>Wobble Goal - 2nd Position</option> <!-- Encoders		-->
                  <option value=7>Wobble Goal - 3rd Position</option> <!-- Functions		-->
                  <option value=8>Drive and Shoot into High Goal</option> <!-- New Motors		-->
                  <option value=9>Drive and Shoot at Powershots</option> <!-- Complex task	-->
                </select>
              </div>
            </div>
            <div style="width:100%; overflow:hidden; background-color: #323232; margin-top: 10px;">
              <h2 id="lessonText" style="font-size: 20px;">[Select a Lesson]</h2>
            </div>
            <div id="lessonButtons" style="padding-top: 12.5px; display: none;">
              <button class="button1" style="position: relative; left: 105px; font-size: 20px;">Show the Task</button>
              <!-- Hello Mihir -->
              <button class="button1" onClick="playVideo(true)"
                style="position: absolute; right: 112.5px; font-size:20px;">Show Video Solution</button>
            </div>
          </div>
          <iframe src="https://virtualftc.jasonbennett.work/courses/basic-movement-with-blocks/'" width="100%"
            height="100%" frameBorder="0" style="display: none;"></iframe>
        </div>
      </div>

      <div id="fieldView" style="height: 50%; margin-top: 10px; background-color: #000000;">
        <iframe scrolling="no" src="./webgl/index.html" id="fieldViewiframe" width="100%" height="100%" frameBorder="0"
          hidden></iframe>
        <div class="center" id="loadingTextDiv">
          <h1 id="loadingText">Loading Field</h1>
        </div>
      </div>
    </div>
  </div>

  <div id="videoTab">
    <div style="display: flex;">
      <a onClick="switchTab(this, 3)" id="backButton"><span class="chevron left"></span></a>
    </div>

    <div class="container" style="display: flex; padding-top: 5px;">
      <div style="width: 100%; background-color: #242424;">
        <div id="videoView" style="background-color: #000000;">
          <iframe src="" width="100%" height="100%" frameBorder="0"></iframe>
        </div>
      </div>
    </div>
  </div>

  <div id="overlay">
    <div id="overlayInfo">
      <div style="display: flex; padding-top: 2.5px;">
        <a id="backButton" style="padding: 7.5px;" onClick="overlay(false, 0)"><span class="chevron left"></span></a>
        <h1 id="overlayName"
          style="text-align: center; width: 347.6px; position: relative; top: 2.5px; margin-bottom: 10px;">Save Program
        </h1>
      </div>
      <div style="width:100%; height: 1px; background-color: #4B4B4B;"></div>
      <div id="overlayType">
        <div>
          <form onSubmit="return false;" style="display: flex; justify-content: center; margin-top: 32.5px;">
            <input type="text" id="saveProgramName" style="font-size: 20px;" placeholder="Enter Name..."
              autocomplete="off">
          </form>
          <button class="button1" onclick="saveProgram()"
            style="font-size: 20px; margin-top: 35px; margin-left: 325px;">Save</button>
        </div>
        <div>
          <img src="./trashProgram.png" style="width: 33%; padding-left: 33%; padding-top: 15px;" />
          <button class="button1" onclick="deleteProgram()"
            style="font-size: 20px; margin-top: 10px; margin-left: 315px;">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('videoView').style.height = .5 * (screen.height) - 69 + "px";
    document.getElementById('videoTab').style.width = .5 * (document.body.clientWidth) - 24 + "px";

    var prevTabButton = document.getElementById('firstTab');

    function switchTab(button, tabNum) {
      if (tabNum == 3) {
        if (button.className == 'textNormal')
          document.getElementById('videoTab').style.display = "inherit";
        else
          document.getElementById('videoTab').style.display = "none";
      }
      else if (button.className == 'textNormal') {
        for (var i = 0; i < document.getElementById('tabOptions').children.length; i++)
          document.getElementById('tabOptions').children[i].style.display = "none";
        document.getElementById('tabOptions').children[tabNum].style.display = "inherit";
        prevTabButton.classList.add('textNormal');
        button.classList.remove('textNormal');
        prevTabButton = button;
      }
    }

    function playVideo(lessonVideo) {
      link = "";
      if (lessonVideo) {
        switch (document.getElementById('lessonSelect').value) {
          case "0":
            link = "https://www.youtube.com/embed/zBjlgFOxw7A";
            break;
          case "1":
            link = "https://www.youtube.com/embed/6VdMtwmT_Ms";
            break;
        }
      }
      else
        link = 'https://www.youtube.com/embed/KXMlbdsr8fM';
      document.getElementById('videoTab').lastElementChild.firstElementChild.firstElementChild.firstElementChild.src = link;
      document.getElementById('videoButton').classList.remove('textDisabled');
      document.getElementById('videoButton').classList.add('textNormal');
      switchTab(document.getElementById('videoButton'), 3);
    }

    function loadLesson() {
      document.getElementById('lessonButtons').style.display = "inherit";
      switch (document.getElementById('lessonSelect').value) {
        case "0":
          document.getElementById('lessonText').innerText = "Difficulty: Easy\n" +
            "In this first lesson, you will need to power the Front Left and Front Right Wheels for a certain amount of time in order to get the robot on the White Line for +5 Points during Autonomous. Press the \"Show the Task\" button to see what you need to do." +
            "\n\nYou'll Learn:\nBasic Motor Powering\nMovement Timing";
          break;
        case "1":
          document.getElementById('lessonText').innerText = "Difficulty: Easy\n" +
            "The next stage will now be to add power to all 4 Wheels in your program. This will require a bit more precision, but will benefit with the added Torque and Speed the motors will provide. Your robot can have a max of 8 motors and 12 servos for full movement!" +
            "\n\nYou'll Learn:\nBalance between Speed and Reliability\nMore Motor Control";
          break;
        case "2":
          document.getElementById('lessonText').innerText = "Difficulty: Easy\n" +
            "For this lesson, we will be adding more than just forwards and backwards and introducing rotation! This may require alot more precision than you initially think. If only there was a way of consistently moving..." +
            "\n\nYou'll Learn:\nThe Limits to using Timing\nRotation Basics";
          break;
        case "3":
          document.getElementById('lessonText').innerText = "Difficulty: Medium\n" +
            "Let's make the robot go along the path of the strongest shape: the Square! Or was it the triangle? Either way it may be useful to use loops for this program so the code looks cleaner and changes can be made faster." +
            "\n\nYou'll Learn:\nThe Joys of Clean Code\nUsing Loop Blocks";
          break;
        case "4":
          document.getElementById('lessonText').innerText = "Difficulty: Medium\n" +
            "Are those mechanum wheels on your robot there? Great! That means you have another mode of movement called strafing where the robot can move directly left and right without turning. The wheels just need to spin a certain way..." +
            "\n\nYou'll Learn:\nThe Art of Expirementing\nStrafing Movement";
          break;
        case "5":
          document.getElementById('lessonText').innerText = "Difficulty: Medium\n" +
            "Alright, now let's start getting some actual autonomous points. First off, let's put the wobble goal in the first position earning +15 points. For right now, we can stick to timing but we can see it becomes a bit more unreliable the more we move." +
            "\n\nYou'll Learn:\nHow to Handle Large Amounts of Code\nComplex Movement";
          break;
        case "6":
          document.getElementById('lessonText').innerText = "Difficulty: Hard\n" +
            "Moving onto the next wobble goal position, we know we need a different system of navigation. Let's try out using motor encoders which can tell us the wheel's current position. Motors: 1440 Ticks per Revolution & Wheels: 4Ï€ Circumfrence." +
            "\n\nYou'll Learn:\nMotor Encoders\nVariables";
          break;
        case "7":
          document.getElementById('lessonText').innerText = "Difficulty: Hard\n" +
            "Great, we have cracked the code for motor encoders! But... the code looks all messy and complicated and would be a pain to make sight changes to. Let's try and compact the 3 main movements into 3 functions we can call." +
            "\n\nYou'll Learn:\nKeeping Code Simple\nFunctions";
          break;
        case "8":
          document.getElementById('lessonText').innerText = "Difficulty: Hard\n" +
            "Looks like the engineering team has just slapped a shooting mechanism onto your robot. Time to learn how that works. It seems they have wired in a new \"ringLoader\" and \"ringShooter\" motor. Let's get 3 rings into that Top Goal scoring +36 points." +
            "\n\nYou'll Learn:\nHandling Multiple Tasks\nComplex Motors";
          break;
        case "9":
          document.getElementById('lessonText').innerText = "Difficulty: Hard\n" +
            "You're Driving Team isn't looking too good during TeleOp. Looks like you'll have to step in to earn those extra points during autonomous. Try and shoot at each powershot for +45 points while either rotating or strafing to change targets." +
            "\n\nYou'll Learn:\nScoring Big in Autonomous\nHow to Code! (hopefully...)";
          break;
        default:
          document.getElementById('lessonButtons').style.display = "none";
          document.getElementById('lessonText').innerText = "[Select Lesson]";
          break;
      }
    }

    function overlay(show, activity) {
      if (show) {
        document.getElementById('overlay').style.animation = "showOverlay .25s ease 1 normal forwards";
        document.getElementById('overlayInfo').style.animation = "showOverlayInfo .5s ease 1 normal forwards";
        switch (activity) {
          case 0:
            document.getElementById('saveProgramName').value = "";
            document.getElementById('overlayName').innerHTML = "Save Program";
            break;
          case 1:
            document.getElementById('overlayName').innerHTML = "Delete Program?";
            break;
        }
        for (var i = 0; i < document.getElementById('overlayType').children.length; i++)
          document.getElementById('overlayType').children[i].style.display = "none";
        document.getElementById('overlayType').children[activity].style.display = "inherit";
      }
      else {
        document.getElementById('overlay').style.animation = "hideOverlay .25s ease 1 normal forwards";
        document.getElementById('overlayInfo').style.animation = "hideOverlayInfo .5s ease 1 normal forwards";
      }
    }

  </script>


  <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
    <category css-icon="customIcon fa fa-long-arrow-right" name="LinearOpMode" colour="30"
      toolboxitemid="linearOpModeCategory">
      <block type="pause"></block>
    </category>

    <category css-icon="customIcon fa fa-gamepad" name="Gamepad" colour="1" toolboxitemid="gamepadCategory">
      <block type="gamepadInputs"></block>
    </category>

    <category css-icon="customIcon fa fa-caret-right" name="Utilities" colour="250" toolboxitemid="utilitiesCategory">
      <category name="Telemetry">
        <block type="telemetryAddData">
          <value name="key">
            <shadow type="text"></shadow>
          </value>
          <value name="data">
            <shadow type="text"></shadow>
          </value>
        </block>
        <block type="telemetryUpdate"></block>
      </category>
    </category>

    <category css-icon="customIcon fa fa-caret-right" name="Actuators" colour="#f58a42" toolboxitemid="motorCategory">
      <category css-icon="customIcon fa fa-caret-right" name="DcMotor">
        <block type="getMotorData">
          <field name="motorOption">["TargetPosition","targetPosition"]</field>
        </block>

        <block type="setMotorDirection">
          <value name="motorOption2">
            <shadow type="directionInput"></shadow>
          </value>
        </block>

        <block type="getMotorDirection"></block>

        <block type="setMotorRunMode">
          <value name="runMode">
            <shadow type="runModeOptions"></shadow>
          </value>
        </block>

        <block type="setMotorInput">
          <value name="power">
            <shadow type="math_number"></shadow>
          </value>
        </block>

        <block type="setMotorZeroPowerBehavior">
          <value name="motorOption2">
            <shadow type="zeroPowerBehaviorOptions"></shadow>
          </value>
        </block>

        <block type="isMotorBusy"></block>
        <!--Creation of the subcategory for the dual DC Motor block-->
        <category name="Dual" toolboxitemid="motorCategory2">
          <block type="setMotorInputDual">
            <value name="power1">
              <shadow type="math_number"></shadow>
            </value>
            <value name="power2">
              <shadow type="math_number"></shadow>
            </value>
          </block>

          <block type="setMotorRunModeDual">
            <value name="input1">
              <shadow type="runModeOptions"></shadow>
            </value>
            <value name="input2">
              <shadow type="runModeOptions"></shadow>
            </value>
          </block>

          <block type="setMotorZeroPowerBehaviorDual">
            <value name="input1">
              <shadow type="zeroPowerBehaviorOptions"></shadow>
            </value>
            <value name="input2">
              <shadow type="zeroPowerBehaviorOptions"></shadow>
            </value>
          </block>
        </category>

        <category name="Extended">
          <block type="setMotorVelocity">
            <value name="input1">
              <shadow type="math_number"></shadow>
            </value>
            <value name="input2">
              <shadow type="setVelocityAngleUnitInput"></shadow>
            </value>
          </block>

          <block type="setMotorEnable"></block>
          <block type="setMotorDisable"></block>
        </category>
      </category>
    </category>

    <sep></sep>

    <category name="Logic" colour="210" toolboxitemid="logicCategory">
      <block type="controls_if"></block>
      <block type="controls_ifelse"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="Loops" colour="110" toolboxitemid="loopsCategory">
      <block type="controls_repeat"></block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for"></block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="Math" colour="230" toolboxitemid="mathCategory">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="math_single"></block>
      <block type="math_trig"></block>
      <block type="math_atan2"></block>
      <block type="math_constant"></block>
      <block type="math_number_property"></block>
      <block type="math_round"></block>
      <block type="math_on_list"></block>
      <block type="math_modulo"></block>
      <block type="math_constrain"></block>
      <block type="math_random_int"></block>
      <block type="math_random_float"></block>
    </category>
    <category name="Text" colour="150" toolboxitemid="textCategory">
      <block type="text"></block>
      <block type="text_print"></block>
      <block type="text_join"></block>
      <block type="text_append"></block>
      <block type="text_length"></block>
      <block type="text_isEmpty"></block>
      <block type="text_indexOf"></block>
      <block type="text_charAt"></block>
      <block type="text_getSubstring"></block>
      <block type="text_changeCase"></block>
      <block type="text_trim"></block>
    </category>
    <category name="Lists" colour="255" toolboxitemid="listCategory">
      <block type="lists_create_empty"></block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat"></block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_getIndex"></block>
      <block type="lists_setIndex"></block>
      <block type="lists_getSublist"></block>
      <block type="lists_split"></block>
      <block type="lists_sort"></block>
    </category>
    <category name="Variables" colour="#a3392c" custom="VARIABLE" toolboxitemid="variablesCategory"></category>
    <category name="Functions" colour="285" custom="PROCEDURE" toolboxitemid="functionsCategory"></category>
    <category name="Miscellaneous" colour="230" toolboxitemid="miscellaneousCategory">
      <block type="comment"></block>
    </category>
  </xml>


  <script>
    localStorage.setItem('startMatch', false);
    localStorage.setItem('stopMatch', false);
    localStorage.setItem('resetField', false);

    var isUsingBlocks = true;
    var delayTime = 0;
    var motorPowers = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
    // var motorEncoderBaseValues = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
    // // TODO: THESE TWO VALUES (ENCBASE, REVERSE) NEED TO BE STORED IN LOCALSTORAGE
    // var motorReverseValues = { "m1": 1.0, "m2": 1.0, "m3": 1.0, "m4": 1.0, "m5": 1.0, "m6": 1.0, "m7": 1.0, "m8": 1.0 };

    localStorage.setItem('motorPowers', JSON.stringify(motorPowers));
    localStorage.setItem('playMode', "Autonomous")

    var shouldBeUpdatingLoadingText = true;
    var counterForLoadingText = 1;
    document.getElementById('controlPanel').style.height = screen.height / 2 - 30 + "px";
    //document.getElementById('lessonPanel').style.height = .485 * (screen.height / 2 - 30) + "px";
    document.getElementById('fieldView').style.height = screen.height / 2 - 30 + "px";
    document.getElementById('onBotJavaDiv').style.height = screen.height - 48 + "px";

    setTimeout(function () {
      shouldBeUpdatingLoadingText = false;
      document.getElementById('fieldViewiframe').hidden = false;
      document.getElementById('loadingText').remove();
      document.getElementById('loadingTextDiv').remove();
    }, 3000);

    const delay = ms => new Promise(res => setTimeout(res, ms));


    const updateLoadingText = async () => {
      while (shouldBeUpdatingLoadingText) {
        if (counterForLoadingText == 1) {
          document.getElementById('loadingText').innerHTML = "Loading Field."
        } else if (counterForLoadingText == 2) {
          document.getElementById('loadingText').innerHTML = "Loading Field.."
        } else if (counterForLoadingText == 3) {
          document.getElementById('loadingText').innerHTML = "Loading Field..."
          counterForLoadingText = 0;
        }
        counterForLoadingText++;
        await delay(500);
      }
    }
    updateLoadingText();

    function switchToBlocks() {
      document.getElementById('blocklyDiv').hidden = false;
      document.getElementById('onBotJavaDiv').hidden = true;
      isUsingBlocks = true;
    }

    function switchToOnBotJava() {
      document.getElementById('blocklyDiv').hidden = true;
      document.getElementById('onBotJavaDiv').hidden = false;
      isUsingBlocks = false;
      setUpOnBotJava();
    }
    var editor;
    function setUpOnBotJava() {
      editor = CodeMirror(function (elt) {
        document.getElementById('onBotJavaDiv').replaceChild(elt, document.getElementById('loadingOBJText'));
      }, {
        value: "public class MyOpMode extends LinearOpMode {\n@Override\npublic void runOpMode() {\n// NOTE: ONBOTJAVA IS STILL UNDER CONSTRUCTION\nwhile (opModeIsActive()) {\nfrontLeft.setPower(1.0);\nfrontLeft.setPower(1.0);\nfrontLeft.setPower(1.0);\nfrontLeft.setPower(1.0);\n}\n}\n}\n",
        mode: "text/x-java",
        lineNumbers: true,
        theme: "darcula",
        scrollbarStyle: null,
        autocorrect: true,
        autoCloseBrackets: true,
      });
      autoFormatSelection();
    }

    function getSelectedRange() {
      return { from: editor.getCursor(true), to: editor.getCursor(false) };
    }

    function autoFormatSelection() {
      var cursor = editor.getCursor();
      CodeMirror.commands["selectAll"](editor);
      var range = getSelectedRange();
      editor.autoFormatRange(range.from, range.to);
      editor.setCursor(cursor);
    }

    function prepareUiToLoadProgram() {
      var keys = Object.keys(localStorage),
        i = keys.length;

      document.getElementById("programSelect").options.length = 1;

      while (i--) {
        console.log(keys[i]);
        if (keys[i].includes("Program Name: ")) {
          var option = document.createElement("option");
          option.value = keys[i].replace("Program Name: ", "");
          option.text = keys[i].replace("Program Name: ", "");
          document.getElementById("programSelect").appendChild(option);
        }
      }
    }

    prepareUiToLoadProgram();

    function newProgram() {
      document.getElementById("programSelect").value = "Load Program";
      document.getElementById('save').disabled = true;
      document.getElementById('delete').disabled = true;
      document.getElementById('download').disabled = true;
      Blockly.mainWorkspace.clear();
      Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom('<xml><block type="onOpmodeStart" deletable="false" movable="true"></block></xml>'), workspace);
      document.getElementById("telemetryText").innerText = 'Cleared Blocks \n';
    }

    function saveProgram() {
      var programName = document.getElementById('saveProgramName').value;
      var xml = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
      localStorage.setItem("Program Name: " + programName, Blockly.Xml.domToText(xml));
      prepareUiToLoadProgram();
      document.getElementById("programSelect").value = document.getElementById('saveProgramName').value;
      document.getElementById('save').disabled = false;
      document.getElementById('delete').disabled = false;
      document.getElementById('download').disabled = false;
      overlay(false, 0);
      document.getElementById("telemetryText").innerText = 'Saved new "' + programName + '" Program \n';
    }

    function autoSave() {
      var programName = document.getElementById('programSelect').value;
      var xml = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
      localStorage.setItem("Program Name: " + programName, Blockly.Xml.domToText(xml));
      document.getElementById("telemetryText").innerText = 'Saved "' + programName + '" Program \n';
    }

    function deleteProgram() {
      var programName = document.getElementById('programSelect').value;
      localStorage.removeItem("Program Name: " + programName);
      newProgram();
      prepareUiToLoadProgram();
      document.getElementById("telemetryText").innerText = 'Deleted "' + programName + '" Program \n';
      overlay(false, 0);
    }

    function loadProgram() {
      Blockly.mainWorkspace.clear();
      var nameOfProject = "Program Name: " + document.getElementById("programSelect").value;
      if (nameOfProject == "Program Name: Load Program") {
        newProgram();
      } else if (typeof (Storage) !== "undefined") {
        document.getElementById('save').disabled = false;
        document.getElementById('delete').disabled = false;
        document.getElementById('download').disabled = false;
        var xml = Blockly.Xml.textToDom(localStorage.getItem(nameOfProject));
        Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, xml);
        document.getElementById("telemetryText").innerText = 'Loaded "' + document.getElementById("programSelect").value + '" Program \n';
      }
    }

    function resetField() {
      localStorage.setItem('resetField', true);
      document.getElementById("telemetryText").innerText = "Field Reset \n";
    }

    function initApi(interpreter, globalObject) {
      // Add an API function for the alert() block.
      var wrapper = function (text) {
        localStorage.setItem('startMatch', true);
        document.getElementById("telemetryText").innerText = "Program Started \n";
        return console.log(arguments.length ? text : '');
      };
      interpreter.setProperty(globalObject, 'alert', interpreter.createNativeFunction(wrapper));

      wrapper = function (motorName, power) {
        power = Math.min(1, Math.max(power, -1));
        if (motorName == "frontLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": power, "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "frontRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": power, "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "backLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": power, "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "backRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": power, "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "ringCollection") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": power, "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "ringLoader") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": power, "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "ringLauncher") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": power, "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "wobbleActuator") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": power };
        }
        return localStorage.setItem('motorPowers', JSON.stringify(motorPowers));
      };
      interpreter.setProperty(globalObject, 'setPower', interpreter.createNativeFunction(wrapper));

      wrapper = function (motorName) {
        motorEncoders = JSON.parse(localStorage.getItem('motorEncoders'));
        encoderValue = 0;
        if (motorName == "frontLeft") {
          encoderValue = motorEncoders[Object.keys(motorEncoders)[0]];// - motorEncoderBaseValues[Object.keys(motorEncoders)[0]];
        } else if (motorName == "frontRight") {
          encoderValue = motorEncoders[Object.keys(motorEncoders)[1]];// - motorEncoderBaseValues[Object.keys(motorEncoders)[1]];
        } else if (motorName == "backLeft") {
          encoderValue = motorEncoders[Object.keys(motorEncoders)[2]];// - motorEncoderBaseValues[Object.keys(motorEncoders)[2]];
        } else if (motorName == "backRight") {
          encoderValue = motorEncoders[Object.keys(motorEncoders)[3]];// - motorEncoderBaseValues[Object.keys(motorEncoders)[3]];
        }
        return encoderValue;
      };
      interpreter.setProperty(globalObject, 'getEncoders', interpreter.createNativeFunction(wrapper));

      wrapper = function (delayTime) {
        pauseTime = delayTime;
        return delayTime;
      };
      interpreter.setProperty(globalObject, 'delay', interpreter.createNativeFunction(wrapper));

      wrapper = function (motor1Name, power, motor2Name, power2) {
        power = Math.min(1, Math.max(power, -1));
        power2 = Math.min(1, Math.max(power2, -1));
        if (motor1Name == "frontLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": power, "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "frontRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": power, "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "backLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": power, "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "backRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": power, "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "ringCollection") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": power, "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "ringLoader") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": power, "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "ringLauncher") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": power, "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "wobbleActuator") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": power };
        }

        if (motor2Name == "frontLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": power2, "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "frontRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": power2, "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "backLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": power2, "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "backRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": power2, "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "ringCollection") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": power2, "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "ringLoader") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": power2, "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "ringLauncher") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": power2, "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "wobbleActuator") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": power2 };
        }
        return localStorage.setItem('motorPowers', JSON.stringify(motorPowers));
      };
      interpreter.setProperty(globalObject, 'setDualPower', interpreter.createNativeFunction(wrapper));

      var wrapper = function (key, data) {
        return (telemetryData.push(key + ": " + data));
      };
      interpreter.setProperty(globalObject, 'addTelemetryData', interpreter.createNativeFunction(wrapper));

      var wrapper = function () {
        var telemetryOutput = "";
        for (var i = 0; i < telemetryData.length; i++)
          telemetryOutput += telemetryData[i] + "\n";
        telemetryData = [];
        return (document.getElementById("telemetryText").innerText = telemetryOutput);
      };
      interpreter.setProperty(globalObject, 'updateTelemetry', interpreter.createNativeFunction(wrapper));
    }

    var telemetryData = [];

    var myInterpreter = null;
    var runner;
    var pauseTime = 0;

    function resetInterpreter() {
      myInterpreter = null;
      pauseTime = 0;
      if (runner) {
        clearTimeout(runner);
        runner = null;
      }
    }

    function startProgram() {
      resetInterpreter();
      setTimeout(delayStartProgram, 100);
    }

    function delayStartProgram() {
      var motorPowers = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
      var code = Blockly.JavaScript.workspaceToCode(Blockly.mainWorkspace);
      console.log(code);
      telemetryData = [];
      myInterpreter = new Interpreter(code, initApi);
      nextStep();
      return;
    }

    function nextStep() {
      if (myInterpreter.step()) {
        setTimeout(nextStep, pauseTime);
        if (pauseTime != 0) {
          pauseTime = 0;
        }
      } else {
        resetInterpreter();
        document.getElementById("telemetryText").innerText = "Program Ended \n";
      }
    }

    function stopProgram() {
      var motorPowers = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
      localStorage.setItem('motorPowers', JSON.stringify(motorPowers));
      localStorage.setItem('stopMatch', true);
      resetInterpreter();
      document.getElementById("telemetryText").innerText = "Program Aborted \n";
    }

    Blockly.JavaScript['onOpmodeStart'] = function (block) {
      return 'alert("Start");\n'
    };

    Blockly.JavaScript['setMotorInput'] = function (block) {
      return 'setPower(\"' + block.getFieldValue('motorName') + '\", ' + Blockly.JavaScript.valueToCode(block, 'power', Blockly.JavaScript.ORDER_NONE) + ');\n'
    };

    Blockly.JavaScript['getMotorData'] = function (block) {
      return ['getEncoders(\"' + block.getFieldValue('motorName') + '\")', Blockly.JavaScript.ORDER_FUNCTION_CALL]
    };

    Blockly.JavaScript['setMotorInputDual'] = function (block) {
      return 'setDualPower(\"' + block.getFieldValue('motorName1') + '\", ' + Blockly.JavaScript.valueToCode(block, 'power1', Blockly.JavaScript.ORDER_NONE) + ', \"' + block.getFieldValue('motorName2') + '\", ' + Blockly.JavaScript.valueToCode(block, 'power2', Blockly.JavaScript.ORDER_NONE) + ');\n'
    };

    Blockly.JavaScript['telemetryAddData'] = function (block) {
      return 'addTelemetryData(' + Blockly.JavaScript.valueToCode(block, 'key', Blockly.JavaScript.ORDER_NONE) + ', ' + Blockly.JavaScript.valueToCode(block, 'data', Blockly.JavaScript.ORDER_NONE) + ');\n'
    };

    Blockly.JavaScript['telemetryUpdate'] = function (block) {
      return 'updateTelemetry();\n'
    };

    Blockly.JavaScript['pause'] = function (block) {
      delayTime = block.getFieldValue('delayTime');
      return 'delay(' + delayTime + ');\n';
    };

    Blockly.JavaScript['comment'] = function (block) {
      var text = block.getFieldValue('commentText');
      return '//' + text + '\n';
    };

    Blockly.JavaScript.addReservedWords('exit');

    var workspace = Blockly.inject('blocklyDiv',
      {
        media: './blocks/media/',
        toolbox: document.getElementById('toolbox'),
        move: {
          scrollbars: true,
          drag: false,
          wheel: false
        },
        theme: {
          'base': Blockly.Themes.Classic,
          'fontStyle': {
            "weight": "bold",
            "size": 12
          },
          'componentStyles': {
            'workspaceBackgroundColour': '#242424',
            "toolboxBackgroundColour": "#333",
            "scrollbarColour": "#424242",
            "toolboxForegroundColour": "#FFFFFF",
            "flyoutBackgroundColour": "#424242",
            "markerColour": "#FFFFFF"
          }
        },
        grid: {
          spacing: 50,
          length: 5,
          colour: '#505050',
        },
        trashcan: true,
        zoom: {
          controls: true,
          wheel: true,
          startScale: 1.0,
          maxScale: 3,
          minScale: 0.3,
          scaleSpeed: 1.2,
          pinch: true
        },

      });

    Blockly.defineBlocksWithJsonArray([
      {
        "type": "onOpmodeStart",
        "message0": "on opmode start",
        "tooltip": "Code attached to this block will run on start",
        "nextStatement": null,
        "colour": "#4287f5",
      },
      {
        "type": "pause",
        "message0": "Wait for %1 milliseconds",
        "tooltip": "Waits for a time in milliseconds",
        "colour": "30",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_number",
            "name": "delayTime",
            "value": 1000,
            "min": 100,
            "max": 10000
          }
        ]
      },
      // Define the parameters for how the physical blocks will look and function in the program


      {
        "type": "gamepadInputs",
        "message0": "%1 . %2",
        "tooltip": "Provides inputs from the gamepads",
        "colour": "1",
        "output": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "gamepadSelection",
            "options": [
              ["gamepad1", "gamepad1"],
              ["gamepad2", "gamepad2"]
            ]
          },
          {
            "type": "field_dropdown",
            "name": "controller_component",
            "options": [
              ["A", "A"],
              ["AtRest", "atRest"],
              ["B", "B"],
              ["Back", "back"],
              ["Circle", "circle"],
              ["Cross", "Cross"],
              ["DpadDown", "dpadDown"],
              ["DpadLeft", "dpadLeft"],
              ["DpadRight", "dpadRight"],
              ["DpadUp", "dpadUp"],
              ["Guide", "guide"],
              ["LeftBumper", "leftBumper"],
              ["LeftStickButton", "leftStickButton"],
              ["Options", "options"],
              ["PS", "PS"],
              ["RightBumper", "rightBumper"],
              ["RightStickButton", "rightStickButton"],
              ["Share", "share"],
              ["Square", "square"],
              ["Start", "start"],
              ["Touchpad", "touchpad"],
              ["Triangle", "triangle"],
              ["X", "X"],
              ["Y", "Y"]
            ]
          }
        ]
      },
      // Experimental block for incorporating both the set power and set target position blocks in one block
      {
        "type": "setMotorInput",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Power", "power"],
              ["MaxSpeed", "maxSpeed"],
              ["TargetPosition", "targetPosition"],
              ["TargetPositionTolerance", "targetPositionTolerance"],
              ["Velocity", "velocity"]
            ]
          },
          {
            "type": "input_value",
            "name": "power"
          }
        ]

      },

      {
        "type": "setMotorInputDual",
        "message0": "set %1 %2 %3 to %4 %5 to %6",
        "tooltip": "Set the motor inputs for two motors at once",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Power", "power"],
              ["MaxSpeed", "maxSpeed"],
              ["TargetPosition", "targetPosition"],
              ["TargetPositionTolerance", "targetPositionTolerance"],
              ["Velocity", "velocity"]
            ]
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "power1",
            "align": "RIGHT"
          },
          {
            "type": "field_dropdown",
            "name": "motorName2",
            "options": [
              ["frontRight", "frontRight"],
              ["frontLeft", "frontLeft"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "power2",
            "align": "RIGHT"
          }
        ]

      },


      {
        "type": "getMotorData",
        "message0": "%1 . %2",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "output": "Number",
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["CurrentPosition", "currentPosition"],
              ["MaxSpeed", "maxSpeed"],
              ["Power", "Power"],
              ["TargetPosition", "targetPosition"],
              ["TargetPositionTolerance", "targetPositionTolerance"],
              ["Velocity", "Velocity"]
            ]
          }
        ]

      },

      // Get the direction of the selected motor
      {
        "type": "getMotorDirection",
        "message0": "%1 . %2",
        "tooltip": "Get the direction of the selected motor",
        "colour": "#f58a42",
        "output": "Number",
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Direction", "direction"]
            ]
          }
        ]

      },

      {
        "type": "isMotorBusy",
        "message0": "call %1 . %2",
        "tooltip": "Checks to see if the selected motor is rnning",
        "colour": "#985ba5",
        "output": "boolean",
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "motorOption",
            "text": "isBusy"
          }
        ]

      },

      {
        "type": "setMotorEnable",
        "message0": "call %1 . %2",
        "tooltip": "Enables the motor called",
        "colour": "#985ba5",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "enableMotor",
            "text": "setMotorEnable"
          }
        ]

      },

      {
        "type": "setMotorDisable",
        "message0": "call %1 . %2",
        "tooltip": "Disables the motor called",
        "colour": "#985ba5",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "enableMotor",
            "text": "setMotorDisable"
          }
        ]

      },


      // Set the run mode for the motors
      {
        "type": "setMotorRunMode",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the run mode of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Mode", "mode"]
            ]
          },
          {
            "type": "input_value",
            "name": "runMode",
          }
        ]

      },

      {
        "type": "setMotorRunModeDual",
        "message0": "set %1 %2 %3 to %4 %5 to %6",
        "tooltip": "Set the motor run mode for two motors at once",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Mode", "mode"]
            ]
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input1",
            "align": "RIGHT"
          },
          {
            "type": "field_dropdown",
            "name": "motorName2",
            "options": [
              ["frontRight", "frontRight"],
              ["frontLeft", "frontLeft"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input2",
            "align": "RIGHT"
          }
        ]

      },



      {
        "type": "runModeOptions",
        "message0": "%1 . %2",
        "tooltip": "Creates the shadow block for the run mode of a given motor",
        "colour": "#f58a42",
        "output": "string",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "RunMode"
          },
          {
            "type": "field_dropdown",
            "name": "runMode",
            "options": [
              ["RUN_WITHOUT_ENCODER", "RUN_WITHOUT_ENCODER"],
              ["RUN_USING_ENCODER", "RUN_USING_ENCODER"],
              ["RUN_TO_POSITION", "RUN_TO_POSITION"],
              ["STOP_AND_RESET_ENCODER", "STOP_AND_RESET_ENCODER"]
            ]
          }
        ]

      },

      // Sets the Zero Power Behavior of the selected motor
      {
        "type": "setMotorZeroPowerBehavior",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the zero power behavior of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["ZeroPowerBehavior", "zeroPowerBehavior"]
            ]
          },
          {
            "type": "input_value",
            "name": "motorOption2",
          }
        ]

      },

      {
        "type": "setMotorZeroPowerBehaviorDual",
        "message0": "set %1 %2 %3 to %4 %5 to %6",
        "tooltip": "Set the motor zero power behavior for two motors at once",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["ZeroPowerBehavior", "mode"]
            ]
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input1",
            "align": "RIGHT"
          },
          {
            "type": "field_dropdown",
            "name": "motorName2",
            "options": [
              ["frontRight", "frontRight"],
              ["frontLeft", "frontLeft"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input2",
            "align": "RIGHT"
          }
        ]

      },

      {
        "type": "zeroPowerBehaviorOptions",
        "message0": "%1 . %2",
        "tooltip": "Shadow block for the set zero power behavior block",
        "colour": "#f58a42",
        "output": "Number",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "ZeroPowerBehavior"
          },
          {
            "type": "field_dropdown",
            "name": "runMode",
            "options": [
              ["BRAKE", "brake"],
              ["FLOAT", "float"]
            ]
          }
        ]

      },

      {
        "type": "setMotorVelocity",
        "message0": "call %1 . %2 %3 angularRate %4 angleUnit %5",
        "tooltip": "Set the motor inputs for two motors at once",
        "colour": "#985ba5",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "setVelocity",
            "text": "setVelocity"
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "input1",
            "align": "RIGHT"
          },
          {
            "type": "input_value",
            "name": "input2",
            "align": "RIGHT"
          }
        ]

      },

      {
        "type": "setVelocityAngleUnitInput",
        "message0": "%1 . %2",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "output": "string",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "AngleUnity"
          },
          {
            "type": "field_dropdown",
            "name": "degrees",
            "options": [
              ["DEGREES", "degrees"]
            ]
          }
        ]

      },


      {
        "type": "directionInput",
        "message0": "%1 . %2",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "output": "string",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "Direction"
          },
          {
            "type": "field_dropdown",
            "name": "direction",
            "options": [
              ["REVERSE", "reverse"],
              ["FORWARD", "forward"]
            ]
          }
        ]

      },

      // This next section defines the layout of the set direction block
      {
        "type": "setMotorDirection",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the direction of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Direction", "direction"]
            ]
          },
          {
            "type": "input_value",
            "name": "motorOption2",
          }

        ]
      },

      /**
       * end of shadow block test section
       * 
       */

      {
        "type": "telemetryUpdate",
        "message0": "call %1 . %2",
        "tooltip": "Update all active telemetry",
        "colour": "250",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_input",
            "name": "Telemetry",
            "text": "Telemetry"
          },
          {
            "type": "field_input",
            "name": "update",
            "text": "update"
          }
        ]
      },

      {
        "type": "comment",
        "message0": "%1",
        "args0": [
          {
            "type": "field_input",
            "name": "commentText",
            "text": "Enter your comment here!"
          }
        ],
        "tooltip": "Update all active telemetry",
        "colour": "230",
        "nextStatement": null,
        "previousStatement": null,
      },


      {
        "type": "telemetryAddData",
        "message0": "call %1 . %2 %3 key %4 %5 data %6",
        "tooltip": "Add Data to active telemetry",
        "colour": "250",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_input",
            "name": "Telemetry",
            "text": "Telemetry"
          },
          {
            "type": "field_input",
            "name": "addData",
            "text": "addData"
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "key",
            "align": "RIGHT"
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "data",
            "align": "RIGHT"
          }
        ]
      },

    ]);

    Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom('<xml><block type="onOpmodeStart" deletable="false" movable="true"></block></xml>'), workspace);
  </script>
</body>

</html>